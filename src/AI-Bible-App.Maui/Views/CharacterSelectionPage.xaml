<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:AI_Bible_App.Maui.ViewModels"
             xmlns:models="clr-namespace:AI_Bible_App.Core.Models;assembly=AI-Bible-App.Core"
             x:Class="AI_Bible_App.Maui.Views.CharacterSelectionPage"
             x:DataType="vm:CharacterSelectionViewModel"
             Title="{Binding Title}">
    
    <!-- Hallow-style gradient background -->
    <ContentPage.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="{StaticResource HallowDarkPurple}" Offset="0.0" />
            <GradientStop Color="{StaticResource HallowDeepBlue}" Offset="0.5" />
            <GradientStop Color="{StaticResource HallowMidPurple}" Offset="1.0" />
        </LinearGradientBrush>
    </ContentPage.Background>
    
    <Grid RowDefinitions="Auto,Auto,*,Auto" Padding="20">
        
        <!-- Header Card -->
        <Frame Grid.Row="0" Margin="0,15,0,15" Padding="20,25"
               BackgroundColor="{StaticResource HallowCardBackground}"
               BorderColor="Transparent"
               CornerRadius="20"
               HasShadow="True">
            <VerticalStackLayout Spacing="8">
                <Label Text="Voices of Scripture"
                       TextColor="{StaticResource HallowTextPrimary}"
                       FontSize="26"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>
                <BoxView HeightRequest="3" WidthRequest="60" CornerRadius="1.5"
                         HorizontalOptions="Center" Margin="0,5,0,8">
                    <BoxView.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                            <GradientStop Color="{StaticResource HallowAccentPurple}" Offset="0.0" />
                            <GradientStop Color="{StaticResource HallowRose}" Offset="1.0" />
                        </LinearGradientBrush>
                    </BoxView.Background>
                </BoxView>
                <Label Text="Connect with Biblical Figures Through AI"
                       TextColor="{StaticResource HallowTextSecondary}"
                       FontSize="14"
                       HorizontalOptions="Center"
                       FontAttributes="Italic"/>
            </VerticalStackLayout>
        </Frame>

        <!-- View Toggle -->
        <Border Grid.Row="1" HorizontalOptions="Center" Margin="0,0,0,15"
                BackgroundColor="{StaticResource HallowCardBackground}" 
                Padding="4" StrokeThickness="0">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="25"/>
            </Border.StrokeShape>
            <HorizontalStackLayout Spacing="6">
                <Border x:Name="CardsViewButton" Padding="18,10" StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="22"/>
                    </Border.StrokeShape>
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                            <GradientStop Color="{StaticResource HallowAccentPurple}" Offset="0.0" />
                            <GradientStop Color="{StaticResource HallowRose}" Offset="1.0" />
                        </LinearGradientBrush>
                    </Border.Background>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnCardsViewClicked"/>
                    </Border.GestureRecognizers>
                    <Label Text="Cards" TextColor="{StaticResource HallowTextPrimary}" 
                           FontSize="15" FontAttributes="Bold" VerticalOptions="Center"/>
                </Border>
                <Border x:Name="ListViewButton" Padding="18,10" 
                        BackgroundColor="Transparent" StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="22"/>
                    </Border.StrokeShape>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnListViewClicked"/>
                    </Border.GestureRecognizers>
                    <Label Text="List" TextColor="{StaticResource HallowTextMuted}" 
                           FontSize="15" FontAttributes="Bold" VerticalOptions="Center"/>
                </Border>
            </HorizontalStackLayout>
        </Border>

        <!-- Carousel View (Cards) -->
        <Grid Grid.Row="2" x:Name="CarouselContainer">
            <CarouselView x:Name="CharacterCarousel"
                          ItemsSource="{Binding Characters}"
                          Loop="True"
                          PeekAreaInsets="40"
                          CurrentItemChanged="OnCarouselItemChanged">
                <CarouselView.ItemTemplate>
                    <DataTemplate x:DataType="models:BiblicalCharacter">
                        <Frame Padding="25,30" Margin="10,5"
                               BackgroundColor="{StaticResource HallowCardBackground}"
                               BorderColor="Transparent"
                               CornerRadius="25"
                               HasShadow="True">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnCharacterCardTapped"/>
                            </Frame.GestureRecognizers>
                            
                            <VerticalStackLayout Spacing="15" HorizontalOptions="Center">
                                <!-- Avatar Circle -->
                                <Frame WidthRequest="100" HeightRequest="100"
                                       CornerRadius="50" Padding="0"
                                       HorizontalOptions="Center"
                                       BorderColor="{StaticResource HallowAccentPurple}">
                                    <Frame.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="{StaticResource HallowAccentPurple}" Offset="0.0" />
                                            <GradientStop Color="{StaticResource HallowRose}" Offset="1.0" />
                                        </LinearGradientBrush>
                                    </Frame.Background>
                                    <Label Text="{Binding Emoji}"
                                           FontSize="45"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"/>
                                </Frame>
                                
                                <!-- Name -->
                                <Label Text="{Binding Name}"
                                       TextColor="{StaticResource HallowTextPrimary}"
                                       FontSize="24"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center"/>
                                
                                <!-- Title Badge -->
                                <Frame Padding="12,6"
                                       BackgroundColor="{StaticResource HallowAccentPurple}"
                                       BorderColor="Transparent"
                                       CornerRadius="15"
                                       HorizontalOptions="Center">
                                    <Label Text="{Binding Title}"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource HallowTextPrimary}"/>
                                </Frame>
                                
                                <!-- Description -->
                                <Label Text="{Binding Description}"
                                       TextColor="{StaticResource HallowTextSecondary}"
                                       FontSize="14"
                                       HorizontalOptions="Center"
                                       HorizontalTextAlignment="Center"
                                       LineBreakMode="WordWrap"
                                       MaxLines="3"
                                       Margin="10,5"/>
                                
                                <!-- Start Chat Button -->
                                <Button Text="Start Conversation →"
                                        BackgroundColor="{StaticResource HallowAccentPurple}"
                                        TextColor="{StaticResource HallowTextPrimary}"
                                        FontAttributes="Bold"
                                        CornerRadius="25"
                                        HeightRequest="50"
                                        WidthRequest="220"
                                        Margin="0,10,0,0"/>
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CarouselView.ItemTemplate>
            </CarouselView>
            
            <!-- Carousel Indicator -->
            <HorizontalStackLayout HorizontalOptions="Center" 
                                   VerticalOptions="End"
                                   Margin="0,0,0,20">
                <IndicatorView x:Name="CharacterIndicator"
                               IndicatorColor="{StaticResource HallowDivider}"
                               SelectedIndicatorColor="{StaticResource HallowAccentPurple}"
                               IndicatorSize="8"/>
            </HorizontalStackLayout>
        </Grid>

        <!-- List View (Alternative, hidden by default) -->
        <!-- CollectionView has built-in scrolling, no ScrollView wrapper needed -->
        <CollectionView Grid.Row="2" x:Name="ListContainer" IsVisible="False"
                        ItemsSource="{Binding Characters}"
                        SelectionMode="Single"
                        SelectionChanged="OnCharacterSelected"
                        VerticalOptions="Fill">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:BiblicalCharacter">
                    <Frame Margin="5,5" Padding="15" 
                           BackgroundColor="{StaticResource HallowCardBackground}"
                           BorderColor="Transparent"
                           CornerRadius="15">
                        <HorizontalStackLayout Spacing="15">
                            <Frame WidthRequest="50" HeightRequest="50" 
                                   CornerRadius="25" Padding="0"
                                   BackgroundColor="{StaticResource HallowAccentPurple}">
                                <Label Text="{Binding Emoji}" 
                                       FontSize="24" 
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                            </Frame>
                            <VerticalStackLayout VerticalOptions="Center" Spacing="4">
                                <Label Text="{Binding Name}"
                                       TextColor="{StaticResource HallowTextPrimary}"
                                       FontSize="18"
                                       FontAttributes="Bold"/>
                                <Label Text="{Binding Title}"
                                       TextColor="{StaticResource HallowTextSecondary}"
                                       FontSize="14"/>
                            </VerticalStackLayout>
                        </HorizontalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Bottom Action Buttons -->
        <Grid Grid.Row="3" ColumnDefinitions="*,*,*" ColumnSpacing="12" Margin="0,15,0,10">
            <!-- Settings -->
            <Frame Grid.Column="0" Padding="14" 
                   BackgroundColor="{StaticResource HallowCardBackground}"
                   BorderColor="Transparent" CornerRadius="20">
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding NavigateToSettingsCommand}"/>
                </Frame.GestureRecognizers>
                <VerticalStackLayout Spacing="6" HorizontalOptions="Center">
                    <Label Text="⚙️" FontSize="26" HorizontalOptions="Center"/>
                    <Label Text="Settings" FontSize="11" FontAttributes="Bold"
                           TextColor="{StaticResource HallowTextSecondary}" HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Frame>
            
            <!-- Prayer -->
            <Frame Grid.Column="1" Padding="14" BorderColor="Transparent" CornerRadius="20">
                <Frame.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="{StaticResource HallowAccentPurple}" Offset="0.0" />
                        <GradientStop Color="{StaticResource HallowRose}" Offset="1.0" />
                    </LinearGradientBrush>
                </Frame.Background>
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding NavigateToPrayerCommand}"/>
                </Frame.GestureRecognizers>
                <VerticalStackLayout Spacing="6" HorizontalOptions="Center">
                    <Label Text="🙏" FontSize="26" HorizontalOptions="Center"/>
                    <Label Text="Prayer" FontSize="11" FontAttributes="Bold"
                           TextColor="{StaticResource HallowTextPrimary}" HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Frame>
            
            <!-- Bible -->
            <Frame Grid.Column="2" Padding="14"
                   BackgroundColor="{StaticResource HallowCardBackground}"
                   BorderColor="Transparent" CornerRadius="20">
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnBibleReaderClicked"/>
                </Frame.GestureRecognizers>
                <VerticalStackLayout Spacing="6" HorizontalOptions="Center">
                    <Label Text="📖" FontSize="26" HorizontalOptions="Center"/>
                    <Label Text="Bible" FontSize="11" FontAttributes="Bold"
                           TextColor="{StaticResource HallowTextSecondary}" HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Frame>
        </Grid>

        <!-- Loading Indicator -->
        <ActivityIndicator Grid.RowSpan="4"
                          IsRunning="{Binding IsBusy}"
                          IsVisible="{Binding IsBusy}"
                          Color="{StaticResource HallowAccentPurple}"
                          WidthRequest="50"
                          HeightRequest="50"
                          HorizontalOptions="Center"
                          VerticalOptions="Center"/>
    </Grid>
</ContentPage>
